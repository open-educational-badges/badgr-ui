<div class="oeb-dashboard-overview">
	<app-kpi-card-grid
		[cards]="kpiCards"
		(cardClick)="onKpiCardClick($event)">
	</app-kpi-card-grid>

	@if (errorState()) {
		<div class="tw-mt-6 tw-bg-red-50 tw-border-2 tw-border-red-200 tw-rounded-lg tw-p-8">
			<div class="tw-flex tw-flex-col tw-items-center tw-justify-center tw-text-center">
				<svg class="tw-w-16 tw-h-16 tw-text-red-500 tw-mb-4" fill="none" stroke="currentColor" viewBox="0 0 24 24">
					<path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 9v2m0 4h.01m-6.938 4h13.856c1.54 0 2.502-1.667 1.732-3L13.732 4c-.77-1.333-2.694-1.333-3.464 0L3.34 16c-.77 1.333.192 3 1.732 3z"/>
				</svg>

				<h3 class="tw-text-xl tw-font-semibold tw-text-red-700 tw-mb-2">
					{{ 'Dashboard.Overview.error.title' | translate }}
				</h3>

				<p class="tw-text-red-600 tw-mb-6">
					{{ errorMessage() }}
				</p>

				<button
					(click)="retryLoad()"
					class="tw-px-6 tw-py-3 tw-bg-red-600 tw-text-white tw-rounded-lg tw-font-medium hover:tw-bg-red-700 tw-transition-colors tw-shadow-md">
					{{ 'Dashboard.Overview.error.retry' | translate }}
				</button>
			</div>
		</div>
	}

	@else if (isLoading()) {
		<div class="tw-mt-6 tw-flex tw-items-center tw-justify-center tw-p-12">
			<div class="tw-flex tw-flex-col tw-items-center tw-space-y-4">
				<div class="tw-w-12 tw-h-12 tw-border-4 tw-border-purple-200 tw-border-t-purple-600 tw-rounded-full tw-animate-spin"></div>
				<p class="tw-text-gray-600 tw-font-medium">
					{{ 'Dashboard.Overview.loading' | translate }}
				</p>
			</div>
		</div>
	}

	@else {
		@if (networkSlug && recentActivities.length > 0) {
			<div class="tw-mt-6">
				<h2 class="tw-text-[22px] tw-font-bold tw-mb-6" style="color: var(--color-purple);">
					{{ 'Network.Dashboard.recentActivity.title' | translate }}
				</h2>
				<app-recent-activity-table
					[activities]="recentActivities">
				</app-recent-activity-table>
			</div>
		}

		<div class="tw-mt-6">
			<div class="tw-flex tw-items-center tw-gap-3 tw-mb-4">
				<h2 class="tw-text-[22px] tw-font-bold" style="color: var(--color-purple);">
					{{ 'Network.Dashboard.competencyTracking.title' | translate }}
				</h2>
				<button
					(click)="navigateToCompetencyTracking()"
					class="tw-flex tw-items-center tw-justify-center tw-cursor-pointer tw-border-none hover:tw-opacity-80 tw-transition-opacity"
					style="width: 40px; height: 40px; border-radius: 5px; background-color: #492E98;">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M5 12h14"/>
						<path d="m12 5 7 7-7 7"/>
					</svg>
				</button>
			</div>
			<div class="tw-w-full tw-p-6" style="background-color: #F5F5F5; border-radius: 5px;">
				<div class="tw-flex tw-flex-row tw-gap-6">
					<div class="tw-bg-white tw-rounded-lg tw-p-6 tw-border-solid" style="border-width: 1px; border-color: var(--color-purple); width: 40%;">
						<h3 class="tw-text-xl tw-font-semibold tw-mb-6" style="color: var(--color-black);">{{ 'Dashboard.topCompetencyAreas' | translate }}</h3>
						@if (skillVisualisationData.length > 0) {
							<recipient-skill-visualisation
								[skills]="skillVisualisationData"
								[showIntroText]="false"
								[showHelpText]="false"
								[showLegend]="false"
								[enableAreaClick]="true"
								[compactMode]="true"
								(areaClick)="onCompetencyAreaClick($event)">
							</recipient-skill-visualisation>
						} @else {
							<div class="tw-flex tw-items-center tw-justify-center tw-h-32 tw-text-gray-500">
								{{ 'Dashboard.noDataAvailable' | translate }}
							</div>
						}
					</div>

					<div class="tw-bg-white tw-rounded-lg tw-p-6 tw-border-solid" style="border-width: 1px; border-color: var(--color-purple); width: 60%;">
						<h3 class="tw-text-xl tw-font-semibold tw-mb-6" style="color: var(--color-black);">{{ 'Dashboard.mostStrengthenedCompetencies' | translate }}</h3>
						@if (individualCompetencyData.length === 0) {
							<div class="tw-flex tw-items-center tw-justify-center tw-h-32 tw-text-gray-500">
								{{ 'Dashboard.noDataAvailable' | translate }}
							</div>
						} @else {
							<app-horizontal-bar-chart
								[items]="getCompetencyBarItems()"
								[labelWidthPercent]="40"
								barContentType="hours"
								barValueSuffix="h"
								[showBarIcon]="true"
								barIconName="lucideClockFading"
								[showEscoLink]="true"
								[clickable]="true"
								(itemClick)="onCompetencyBarClick($event)">
							</app-horizontal-bar-chart>
						}
					</div>
				</div>
			</div>
		</div>

		<div class="tw-mt-6">
			<div class="tw-flex tw-items-center tw-gap-3 tw-mb-4">
				<h2 class="tw-text-[22px] tw-font-bold" style="color: var(--color-purple);">
					{{ 'Network.Dashboard.badgeAnalysis.title' | translate }}
				</h2>
				<button
					(click)="navigateToBadgeAnalysis()"
					class="tw-flex tw-items-center tw-justify-center tw-cursor-pointer tw-border-none hover:tw-opacity-80 tw-transition-opacity"
					style="width: 40px; height: 40px; border-radius: 5px; background-color: #492E98;"
					[attr.aria-label]="'Zur Badge-Analyse'"
					title="Zur Badge-Analyse">
					<svg width="20" height="20" viewBox="0 0 24 24" fill="none" stroke="white" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
						<path d="M5 12h14"/>
						<path d="m12 5 7 7-7 7"/>
					</svg>
				</button>
			</div>
			<div class="tw-w-full tw-p-6" style="background-color: #F5F5F5; border-radius: 5px;">
			<div class="tw-bg-white tw-rounded-lg tw-p-6 tw-border-solid tw-mb-6" style="border-width: 1px; border-color: var(--color-purple);">
				<h3 class="tw-text-xl tw-font-semibold tw-mb-4" style="color: var(--color-black);">{{ 'Dashboard.badgesAwardedInYear' | translate }}</h3>

				<app-badges-yearly-line-chart
					[data]="badgeAwardsByTime"
					[selectedYear]="selectedYear"
					[selectedBadgeType]="selectedBadgeType"
					[availableYears]="availableYears"
					[badgeTypes]="badgeTypes"
					[showYearFilter]="true"
					[showTypeFilter]="true"
					[chartHeight]="400"
					[isVisible]="true"
					[isLoading]="isLoadingTimeline"
					(yearChange)="onYearChange($event)"
					(typeChange)="onBadgeTypeFilterChange($event)">
				</app-badges-yearly-line-chart>
			</div>

			<div class="tw-grid tw-grid-cols-1 lg:tw-grid-cols-2 tw-gap-6">
				<div class="tw-bg-white tw-rounded-lg tw-p-6 tw-border-solid" style="border-width: 1px; border-color: var(--color-purple);">
					<h3 class="tw-text-xl tw-font-semibold tw-mb-6" style="color: var(--color-black);">{{ 'Dashboard.badgeDistributionByType' | translate }}</h3>

					<app-badge-distribution-pie-chart
						[segments]="badgeTypePieChartSegments"
						[total]="totalBadges"
						totalLabel="Badge Classes"
						[translateTotalLabel]="false"
						labelPosition="left"
						[labelsClickable]="false"
						size="large">
					</app-badge-distribution-pie-chart>
				</div>

				<div class="tw-bg-white tw-rounded-lg tw-p-6 tw-border-solid" style="border-width: 1px; border-color: var(--color-purple);">
					<h3 class="tw-text-xl tw-font-semibold tw-mb-6" style="color: var(--color-black);">{{ 'Dashboard.institutionsRanking' | translate }}</h3>
					<app-dashboard-top-badges
						[top3Badges]="top3Institutions"
						[clickable]="true"
						[enableRouting]="false"
						[useOctagonFrame]="true"
						(itemClick)="onInstitutionRankingClick($event)">
					</app-dashboard-top-badges>
				</div>
			</div>
			</div>
		</div>
	}
</div>
